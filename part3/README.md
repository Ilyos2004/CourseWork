# ЭТАП 3  
## Реализация архитектуры и серверной части информационной системы

---

## 1. Цель этапа

Целью третьего этапа курсовой работы является реализация архитектуры информационной системы, уровня хранения данных и уровня бизнес-логики на основе базы данных, разработанной на предыдущем этапе.

---

## 2. Общая архитектура серверной части

Серверная часть информационной системы реализована с использованием трёхуровневой архитектуры, включающей:

- уровень представления (REST API);
- уровень бизнес-логики;
- уровень хранения данных.

Данная архитектура обеспечивает разделение ответственности между компонентами системы, упрощает сопровождение и расширение функциональности.

---

## 3. Реализация уровня хранения данных

Уровень хранения данных реализован на основе реляционной базы данных PostgreSQL, структура которой была разработана и реализована на предыдущем этапе курсовой работы.

Для доступа к данным используется технология **Spring Data JPA**. Каждой таблице базы данных соответствует класс сущности, аннотированный с использованием JPA.

В системе реализованы сущности, соответствующие основным объектам предметной области, таким как пользователь, профиль ученика, профиль репетитора, временной слот занятия, бронирование, отзыв и предмет.

Для выполнения операций чтения и записи данных используются репозитории, унаследованные от интерфейса `JpaRepository`.

---

### 3.1 Использование функций и процедур PL/pgSQL

При реализации уровня хранения данных используются функции и триггеры, разработанные на предыдущем этапе с использованием языка **PL/pgSQL**.  
Использование альтернативной реализации аналогичной логики на уровне приложения не применяется.

Критичные операции системы реализованы непосредственно на уровне базы данных и вызываются из репозиториев с использованием **native-запросов**.

В системе используются следующие функции и триггеры:

- функция получения списка доступных временных слотов занятий;
- функция добавления отзыва с автоматическим пересчётом рейтинга репетитора;
- триггер проверки невозможности бронирования занятия после его начала;
- триггер проверки вместимости временного слота при бронировании;
- триггер автоматической отмены бронирований при отмене занятия.

Вызов функций PL/pgSQL осуществляется из репозиториев через native-запросы, что обеспечивает строгую реализацию бизнес-ограничений на уровне базы данных.

---

## 4. Реализация уровня бизнес-логики

Уровень бизнес-логики реализован в сервисном слое серверного приложения.  
Сервисный слой инкапсулирует правила предметной области и обеспечивает корректное взаимодействие между контроллерами и уровнем хранения данных.

В системе реализованы следующие сервисы:

- сервис аутентификации и регистрации пользователей;
- сервис управления временными слотами занятий;
- сервис бронирования занятий;
- сервис работы с отзывами;
- сервис административного управления системой.

Каждый сервис отвечает за реализацию конкретных бизнес-процессов и использует репозитории для доступа к данным.

---

### 4.1 Реализация бизнес-процессов

Бизнес-процессы системы реализованы в соответствии с требованиями, сформированными на первом этапе курсовой работы.

Основные реализованные бизнес-процессы включают:

- регистрацию и авторизацию пользователей с различными ролями;
- создание и управление профилями учеников и репетиторов;
- публикацию репетиторами доступных временных слотов занятий;
- бронирование занятий учениками с автоматической проверкой ограничений;
- отмену занятий и автоматическую отмену связанных бронирований;
- добавление отзывов и автоматический пересчёт рейтингов репетиторов;
- административное управление пользователями, профилями и справочником предметов.

---

## 5. Реализация REST API

Для взаимодействия клиентской части с серверной частью системы реализован **REST API**.

REST-контроллеры принимают HTTP-запросы, выполняют валидацию входных данных, передают управление сервисному слою и возвращают результаты выполнения операций в формате **JSON**.

В системе реализованы следующие группы REST-эндпоинтов:

- эндпоинты регистрации и авторизации пользователей;
- эндпоинты управления временными слотами занятий;
- эндпоинты бронирования занятий;
- эндпоинты работы с отзывами;
- административные эндпоинты для управления пользователями и предметами.

---

## 6. Обеспечение безопасности

Для обеспечения безопасности системы используется **Spring Security**.

Реализованы механизмы аутентификации и авторизации пользователей на основе ролей.  
Доступ к административным эндпоинтам ограничен пользователями с ролью администратора.

Пароли пользователей хранятся в базе данных в зашифрованном виде с использованием алгоритма хэширования **BCrypt**.

---

## 7. Результаты этапа

В результате выполнения третьего этапа была реализована серверная часть информационной системы, включающая уровень хранения данных и уровень бизнес-логики.

Реализация полностью основана на базе данных и функциях PL/pgSQL, разработанных на предыдущем этапе, и соответствует требованиям методических указаний.

---

## 8. Выводы

Реализованная архитектура серверной части обеспечивает надёжную и расширяемую основу для информационной системы назначения репетиторских занятий.

Использование функций и триггеров PL/pgSQL позволяет перенести критичную бизнес-логику на уровень базы данных и обеспечить целостность данных независимо от логики приложения.
